<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <script>
    (function() {
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      if (isMobile) {
        document.write('<meta name="viewport" content="width=1400">');
      } else {
        document.write('<meta name="viewport" content="width=device-width, initial-scale=1.0">');
      }
    })();
  </script>
  <title>XXVCLUB TRADING JOURNAL</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
  
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    :root {
      --bg: #f8f9fb;
      --card-bg: #ffffff;
      --text-main: #1a1d23;
      --text-muted: #70757e;
      --border: #e2e4e8;
      --win-bg: #e8f7f0;
      --win-text: #22c55e;
      --win-border: #bbf7d0;
      --loss-bg: #fef2f2;
      --loss-text: #ef4444;
      --loss-border: #fecaca;
      --be-bg: #f1f3f5;
      --be-text: #495057;
      --accent: #7c3aed;
      --tooltip-bg: #1e293b;
    }

    [data-theme="dark"] {
      --bg: #0f172a;
      --card-bg: #1e293b;
      --text-main: #f1f5f9;
      --text-muted: #94a3b8;
      --border: #334155;
      --win-bg: #064e3b;
      --win-text: #4ade80;
      --loss-bg: #7f1d1d;
      --loss-text: #f87171;
      --be-bg: #334155;
      --be-text: #cbd5e1;
      --accent: #a78bfa;
      --tooltip-bg: #475569;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Quicksand', sans-serif;
      background: var(--bg);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      padding: 10px;
    }

    .app {
      width: 100%;
      height: 100%;
      max-width: 1400px;
      background: var(--card-bg);
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
    }

    .app-title {
      text-align: center;
      font-size: 1.1rem;
      color: var(--text-main);
      font-weight: 700;
      letter-spacing: 2px;
      margin-bottom: 10px;
      padding-bottom: 10px;
      text-transform: uppercase;
      border-bottom: 2px solid var(--border);
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 10px;
      flex-shrink: 0;
    }

    .month-nav { display: flex; align-items: center; gap: 8px; }
    .month-nav h2 { font-size: 1.1rem; font-weight: 700; margin: 0; min-width: 160px; text-align: center; }

    .stats-bar { display: flex; align-items: center; gap: 8px; }

    .pnl-container { display: flex; align-items: center; gap: 6px; font-size: 1rem; font-weight: 700; }

    .monthly-r-total {
      padding: 4px 10px;
      border-radius: 6px;
      min-width: 70px;
      text-align: center;
    }
    
    .monthly-r-total.win { color: var(--win-text); background: var(--win-bg); }
    .monthly-r-total.loss { color: var(--loss-text); background: var(--loss-bg); }
    .monthly-r-total.be { color: var(--be-text); background: var(--be-bg); }

    .badge {
      background: var(--border);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--text-muted);
    }

    /* Button styles & Hover Tooltips */
    .btn {
      position: relative;
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--card-bg);
      color: var(--text-main);
      cursor: pointer;
      font-family: inherit;
      font-weight: 600;
      font-size: 0.8rem;
    }

    /* Tooltip styling on buttons */
    .btn[data-tooltip]::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--tooltip-bg);
      color: #fff;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 0.7rem;
      white-space: nowrap;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.2s, visibility 0.2s;
      z-index: 100;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      pointer-events: none;
      font-weight: 500;
    }

    .btn:hover::after {
      visibility: visible;
      opacity: 1;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 6px;
      flex: 1; 
      min-height: 0;
    }

    .grid-label {
      text-align: center;
      font-size: 0.8rem;
      font-weight: 700;
      color: var(--text-main);
      text-transform: uppercase;
      padding-bottom: 5px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }

    .day {
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 6px;
      display: flex;
      flex-direction: column;
      background: var(--card-bg);
      cursor: pointer;
      overflow: hidden;
      transition: background 0.2s;
    }

    .day:hover { border-color: var(--accent); background: rgba(124, 58, 237, 0.02); }
    .day.empty { background: transparent; border-color: transparent; cursor: default; }

    .day-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
    .day-num { font-size: 0.75rem; font-weight: 700; color: var(--text-muted); }
    .daily-total { font-size: 0.8rem; font-weight: 700; }

    .trade-list {
      flex: 1;
      overflow-y: auto;
      scrollbar-width: none;
    }
    .trade-list::-webkit-scrollbar { display: none; }

    .trade-pill {
      font-size: 0.65rem;
      font-weight: 600;
      padding: 2px 5px;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2px;
      background: var(--bg);
      border-left: 3px solid var(--border);
    }

    .trade-pill.win { background: var(--win-bg); border-left-color: var(--win-text); color: var(--win-text); }
    .trade-pill.loss { background: var(--loss-bg); border-left-color: var(--loss-text); color: var(--loss-text); }
    .trade-pill.be { background: var(--be-bg); border-left-color: var(--be-text); color: var(--be-text); }

    .day.win-day { border-top: 3px solid var(--win-text); }
    .day.loss-day { border-top: 3px solid var(--loss-text); }
    .day.be-day { border-top: 3px solid var(--be-text); }

    .week-summary {
      border: 1px solid var(--border);
      background: var(--bg);
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 4px;
    }

    .week-label { font-size: 0.6rem; color: var(--text-muted); font-weight: 700; }
    .week-total { font-size: 0.8rem; font-weight: 700; }

    footer {
      margin-top: 10px;
      text-align: center;
      font-size: 0.65rem;
      color: var(--text-muted);
      opacity: 0.8;
      font-weight: 500;
    }

    .btn-reset {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: var(--loss-bg);
      color: var(--loss-text);
      font-size: 0.65rem;
      opacity: 0.6;
    }

    .delete-trade { cursor: pointer; margin-left: 4px; opacity: 0.5; }
    .delete-trade:hover { opacity: 1; }
  </style>
</head>
<body>

<div class="app" id="app">
  <div class="app-title">XXVCLUB TRADING JOURNAL</div>

  <header>
    <div class="month-nav">
      <button class="btn" onclick="changeMonth(-1)" data-tooltip="Previous Month">â—€</button>
      <h2 id="current-month-display"></h2>
      <button class="btn" onclick="changeMonth(1)" data-tooltip="Next Month">â–¶</button>
    </div>
    
    <div class="stats-bar">
      <div class="pnl-container">
        <span>PNL:</span>
        <div class="monthly-r-total" id="monthly-r-total"></div>
      </div>
      <div class="badge" id="month-stats"></div>

      <button class="btn" onclick="toggleUnit()" id="unit-toggle" data-tooltip="Switch R / $ View">Mode: R</button>
      <button class="btn" onclick="toggleTheme()" id="theme-toggle" data-tooltip="Toggle Dark Mode">ðŸŒ™</button>
      <button class="btn" onclick="takeShot()" data-tooltip="Save Screenshot">ðŸ“¸</button>
      <button class="btn" onclick="exportCSV()" data-tooltip="Export Data (CSV)">ðŸ“¤</button>
      
      <label class="btn" data-tooltip="Import Data (CSV)" style="display: flex; align-items: center; cursor: pointer;">
        ðŸ“¥ <input type="file" id="csv-input" accept=".csv" style="display: none;" onchange="importCSV(event)">
      </label>
    </div>
  </header>

  <div class="calendar-grid" id="main-grid">
    <div class="grid-label">Sun</div>
    <div class="grid-label">Mon</div>
    <div class="grid-label">Tue</div>
    <div class="grid-label">Wed</div>
    <div class="grid-label">Thu</div>
    <div class="grid-label">Fri</div>
    <div class="grid-label">Sat</div>
    <div class="grid-label"></div> <div id="calendar-days" style="display: contents;"></div>
  </div>

  <footer>Vibe coded by @0x5ive</footer>
</div>

<button class="btn btn-reset" onclick="resetData()" data-tooltip="Clear current month trades">Reset Data</button>

<script>
  const daysGrid = document.getElementById('calendar-days');
  const monthDisplay = document.getElementById('current-month-display');
  const monthlyRLabel = document.getElementById('monthly-r-total');
  
  let currentDate = new Date();
  currentDate.setDate(1);
  let trades = JSON.parse(localStorage.getItem('tradingDataV6')) || {};
  let displayMode = 'R'; 
  let riskPerTrade = 100;

  function toggleTheme() {
    const body = document.body;
    const btn = document.getElementById('theme-toggle');
    if (body.getAttribute('data-theme') === 'dark') {
      body.removeAttribute('data-theme');
      btn.textContent = 'ðŸŒ™';
    } else {
      body.setAttribute('data-theme', 'dark');
      btn.textContent = 'â˜€ï¸';
    }
  }

  function toggleUnit() {
    if (displayMode === 'R') {
      const val = prompt("Risk per Trade ($):", riskPerTrade);
      if (val === null) return;
      riskPerTrade = parseFloat(val) || 100;
      displayMode = '$';
      document.getElementById('unit-toggle').textContent = 'Mode: $';
    } else {
      displayMode = 'R';
      document.getElementById('unit-toggle').textContent = 'Mode: R';
    }
    render();
  }

  function changeMonth(delta) { currentDate.setMonth(currentDate.getMonth() + delta); render(); }

  function formatR(val, showPlus = true) {
    if (val === 0) return "BE";
    if (displayMode === '$') {
      const dollarVal = val * riskPerTrade;
      return (showPlus && dollarVal > 0 ? "+" : "") + "$" + Math.round(dollarVal).toLocaleString();
    }
    return (showPlus && val > 0 ? "+" : "") + val.toFixed(1) + "R";
  }

  function render() {
    daysGrid.innerHTML = '';
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    monthDisplay.textContent = `${currentDate.toLocaleString('default', { month: 'long' })} ${year}`;

    const firstDayIndex = new Date(year, month, 1).getDay();
    const lastDay = new Date(year, month + 1, 0).getDate();
    
    let monthTotal = 0, totalTradesCount = 0, winningTradesCount = 0, lossTradesCount = 0, beTradesCount = 0, activeDays = 0, dayCounter = 1, weekCounter = 1;

    for (let row = 0; row < 6; row++) {
      let weekTotal = 0, hasDayInWeek = false;

      for (let col = 0; col < 7; col++) {
        const dayEl = document.createElement('div');
        const currentIndex = (row * 7) + col;

        if (currentIndex < firstDayIndex || dayCounter > lastDay) {
          dayEl.className = 'day empty';
        } else {
          hasDayInWeek = true;
          const dateKey = `${year}-${month + 1}-${dayCounter}`;
          const dayData = trades[dateKey] || [];
          const dailySum = dayData.reduce((acc, t) => acc + t.r, 0);
          
          dayEl.className = 'day';
          if (dayData.length > 0) {
            dayEl.classList.add(dailySum > 0 ? 'win-day' : (dailySum < 0 ? 'loss-day' : 'be-day'));
            activeDays++;
            totalTradesCount += dayData.length;
            dayData.forEach(t => { 
              if(t.r > 0) winningTradesCount++; 
              else if(t.r < 0) lossTradesCount++;
              else beTradesCount++;
            });
            monthTotal += dailySum;
            weekTotal += dailySum;
          }
          
          const d = dayCounter; 
          dayEl.onclick = (e) => { if(!e.target.classList.contains('delete-trade')) addTrade(dateKey, d); };
          
          dayEl.innerHTML = `
            <div class="day-header">
              <span class="day-num">${d}</span>
              ${dayData.length > 0 ? `<span class="daily-total" style="color: ${dailySum > 0 ? 'var(--win-text)' : (dailySum < 0 ? 'var(--loss-text)' : 'var(--be-text)')}">${formatR(dailySum)}</span>` : ''}
            </div>
            <div class="trade-list">
              ${dayData.map((t, i) => `
                <div class="trade-pill ${t.r > 0 ? 'win' : (t.r < 0 ? 'loss' : 'be')}">
                  <span>${t.dir}${t.pair} ${formatR(t.r)}</span>
                  <span class="delete-trade" onclick="deleteTrade('${dateKey}', ${i})">Ã—</span>
                </div>
              `).join('')}
            </div>
          `;
          dayCounter++;
        }
        daysGrid.appendChild(dayEl);
      }

      const weekEl = document.createElement('div');
      weekEl.className = 'week-summary';
      if (hasDayInWeek) {
        weekEl.innerHTML = `<div class="week-label">WEEK ${weekCounter}</div>
          <div class="week-total" style="color: ${weekTotal > 0 ? 'var(--win-text)' : (weekTotal < 0 ? 'var(--loss-text)' : 'var(--be-text)')}">
            ${formatR(weekTotal)}
          </div>`;
        weekCounter++;
      } else { weekEl.style.visibility = 'hidden'; }
      daysGrid.appendChild(weekEl);
      if (dayCounter > lastDay && row >= 4) break; 
    }

    const winRate = totalTradesCount > 0 ? ((winningTradesCount / totalTradesCount) * 100).toFixed(1) : 0;
    monthlyRLabel.textContent = formatR(monthTotal);
    monthlyRLabel.className = `monthly-r-total ${monthTotal > 0 ? 'win' : (monthTotal < 0 ? 'loss' : 'be')}`;
    
    document.getElementById('month-stats').innerHTML = `
      ${activeDays} trading days | ${totalTradesCount} trades 
      (<span style="color: var(--win-text)">${winningTradesCount}W</span> - 
       <span style="color: var(--loss-text)">${lossTradesCount}L</span> - 
       <span style="color: var(--be-text)">${beTradesCount}BE</span>) 
      | ${winRate}% WR
    `;

    localStorage.setItem('tradingDataV6', JSON.stringify(trades));
  }

  function addTrade(dateKey, dayNum) {
    let dir = prompt("Direction (B = BUY & S = SELL):", "B") || "B";
    let pair = prompt("Pair:", "BTC") || "BTC";
    let rInput = prompt("Trade outcome in R-Multiple (or BE):", "1");
    if (rInput === null) return;
    let r = rInput.toUpperCase() === 'BE' ? 0 : parseFloat(rInput);
    if (isNaN(r)) return;
    if (!trades[dateKey]) trades[dateKey] = [];
    trades[dateKey].push({ r, pair: pair.toUpperCase(), dir: dir.toUpperCase() + "/" });
    render();
  }

  function deleteTrade(dateKey, index) {
    event.stopPropagation();
    if(confirm("Delete trade?")) {
      trades[dateKey].splice(index, 1);
      if(trades[dateKey].length === 0) delete trades[dateKey];
      render();
    }
  }

  function resetData() {
    const monthName = currentDate.toLocaleString('default', { month: 'long' });
    const year = currentDate.getFullYear();
    
    if (confirm(`Delete all trade history for ${monthName} ${year}?`)) {
      const monthToClear = currentDate.getMonth() + 1;
      const yearToClear = currentDate.getFullYear();

      Object.keys(trades).forEach(dateKey => {
        const [y, m, d] = dateKey.split('-');
        if (parseInt(y) === yearToClear && parseInt(m) === monthToClear) {
          delete trades[dateKey];
        }
      });

      render();
    }
  }

  function exportCSV() {
    let csvContent = "Date,Direction,Pair,R-Multiple\n";
    Object.keys(trades).forEach(date => {
      trades[date].forEach(t => {
        csvContent += `${date},${t.dir.replace('/', '')},${t.pair},${t.r}\n`;
      });
    });
    
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement("a");
    const url = URL.createObjectURL(blob);
    link.setAttribute("href", url);
    link.setAttribute("download", `trading_journal_backup.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  function importCSV(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
      const text = e.target.result;
      const lines = text.split('\n');
      const newTrades = {};
      
      for (let i = 1; i < lines.length; i++) {
        if (!lines[i].trim()) continue;
        const [date, dir, pair, r] = lines[i].split(',');
        if (!date || !dir || !pair || r === undefined) continue;
        
        if (!newTrades[date]) newTrades[date] = [];
        newTrades[date].push({
          dir: dir.trim() + "/",
          pair: pair.trim(),
          r: parseFloat(r)
        });
      }
      
      if (confirm("Importing will merge these trades with your current data. Continue?")) {
        Object.keys(newTrades).forEach(date => {
          if (!trades[date]) trades[date] = [];
          trades[date] = [...trades[date], ...newTrades[date]];
        });
        localStorage.setItem('tradingDataV6', JSON.stringify(trades));
        render();
        alert("Import successful!");
      }
    };
    reader.readAsText(file);
    event.target.value = "";
  }

  async function takeShot() {
    const app = document.getElementById('app');
    const canvas = await html2canvas(app, { scale: 2, backgroundColor: getComputedStyle(document.body).getPropertyValue('--bg') });
    const link = document.createElement('a');
    link.download = `Journal_${monthDisplay.textContent}.png`;
    link.href = canvas.toDataURL();
    link.click();
  }

  render();
</script>
</body>
</html>